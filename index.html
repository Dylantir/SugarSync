<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tienda de Golosinas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff7f8;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #e60073;
    }
    .contenedor {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #ff4da6;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #ff1a8c;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #ffb3d9;
    }
    canvas {
      width: 100%;
      max-height: 300px;
      margin-top: 30px;
    }
    /* lista de sugerencias */
    #listaSugerencias {
      border: 1px solid #ccc;
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
      background: white;
      position: absolute;
      width: 300px;
      z-index: 100;
    }
    #listaSugerencias div {
      padding: 8px;
      cursor: pointer;
    }
    #listaSugerencias div:hover {
      background-color: #ffe6f0;
    }
  </style>
</head>
<body>

  <h1>üç¨ Tienda de Golosinas üç≠</h1>
  <div class="contenedor">
    <h3>Registrar Venta</h3>
    <div style="position: relative;">
      <input type="text" id="nombreProducto" placeholder="Nombre del producto (ej: Gansito)" onkeyup="mostrarSugerencias()">
      <div id="listaSugerencias"></div>
    </div>
    <input type="number" id="cantidad" placeholder="Cantidad" min="1">
    <button onclick="agregarProducto()">Agregar producto</button>
    <button onclick="finalizarVenta()">Finalizar venta</button>

    <div id="mensaje"></div>

    <div id="tablaCompras"></div>

    <canvas id="graficoVentas"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ======= Datos iniciales =======
    const productos = {
      "gansito": 2500, "chocorramo": 3000, "galleta festival": 1200,
      "galleta oreo": 1500, "jet": 1000, "bon bon bum": 600, "milky way": 2800,
      "snickers": 2700, "milhoja": 3500, "chicle trident": 800, "chicle bubbaloo": 500,
      "ponymalta": 2500, "postobon manzana": 2000, "coca cola": 2500,
      "agua cristal": 1500, "papas margarita": 2500, "detodito": 3000,
      "platanitos": 2200, "galleta club social": 1500, "submarino": 2500,
      "arequipe alpina": 2000, "yogurt alpina": 2500, "bocadillo vele√±o": 800,
      "bocadillo con queso": 1500, "chocobreak": 1000, "chocoso": 1200,
      "chocojet": 1300, "quipitos": 900, "crispeta": 2000, "pirulin": 1800,
      "supercoco": 600, "bubaloo": 500, "menta": 300, "gomitas fini": 2500,
      "gomitas trululu": 2300, "barrilete": 1500, "galleta ducales": 2000,
      "galleta soda": 1500, "frunas": 400, "bocadillo rollo": 1000,
      "browni": 3000, "chocolate jet": 1200, "ponque ramo": 2800,
      "pastel gloria": 2700, "bocadillo ranchero": 800, "yupi": 1800,
      "galleta chokis": 2000, "choco krispis": 3500, "oreo doble crema": 1800,
      "nucita": 1200, "chocoboom": 1000, "milkybar": 2000, "m&m": 2500,
      "hersheys": 3000, "trululu": 1000, "barrilete surtido": 1600,
      "chocoramo mini": 1800, "galleta wafer": 1000, "chocolate corona": 1500,
      "yogurt kumis": 2300, "gomitas ositos": 2000, "jugo hit": 2200,
      "jugo del valle": 2000, "agua panela": 1200, "bocadillo lonja": 700,
      "manimoto": 1500, "mani salado": 1000, "mani japones": 1200,
      "mani dulce": 1200, "tostacos": 2500, "cheetos": 2500,
      "doritos": 2500, "lays": 2500, "tosti arepa": 2000, "achiras": 1500,
      "rosquitas": 1500, "ponque gala": 2800, "ponque choco gala": 3000,
      "alpinette": 3500, "maxibon": 4000, "chocorramo mini": 1800,
      "mermelada mora": 1800, "mermelada fresa": 1800, "colombina": 1000,
      "bombon": 600, "caramelo": 500, "tostones": 2000, "ponymalta mini": 1800,
      "ponymalta lata": 2500, "coca cola lata": 2500, "hit caja": 2000,
      "leche alpina": 2500, "almojabana": 2000, "empanada": 1800,
      "dona ramo": 3000, "brownie choco": 3500, "cereal bar": 2000,
      "chocolatina jet": 1200, "pan bimbo": 3500, "galleta festival mini": 1000
    };

    let numeroVenta = 1;
    let historial = JSON.parse(localStorage.getItem("historial")) || [];

    // ======= Mostrar sugerencias =======
    function mostrarSugerencias() {
      const input = document.getElementById("nombreProducto");
      const sugerencias = document.getElementById("listaSugerencias");
      const texto = input.value.trim().toLowerCase();
      sugerencias.innerHTML = "";

      if (texto === "") return;

      const coincidencias = Object.keys(productos).filter(p => p.includes(texto));

      coincidencias.forEach(p => {
        const div = document.createElement("div");
        div.textContent = `${p} - $${productos[p].toLocaleString("es-CO")}`;
        div.onclick = () => {
          input.value = p;
          sugerencias.innerHTML = "";
        };
        sugerencias.appendChild(div);
      });
    }

    // ======= Agregar producto =======
    function agregarProducto() {
      const nombre = document.getElementById('nombreProducto').value.trim().toLowerCase();
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const mensaje = document.getElementById('mensaje');

      if (!productos[nombre]) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Producto no encontrado. Intenta con otro nombre.</p>`;
        return;
      }
      if (!cantidad || cantidad <= 0) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Cantidad inv√°lida.</p>`;
        return;
      }

      const precio = productos[nombre];
      const total = precio * cantidad;
      historial.push({ numeroVenta, nombre, cantidad, precio, total });
      localStorage.setItem("historial", JSON.stringify(historial));

      mensaje.innerHTML = `<p style="color:green">‚úÖ ${cantidad} ${nombre}(s) agregado(s) a la venta #${numeroVenta}</p>`;
      document.getElementById('nombreProducto').value = '';
      document.getElementById('cantidad').value = '';
      mostrarTabla();
      mostrarGrafico();
    }

    // ======= Finalizar venta =======
    function finalizarVenta() {
      numeroVenta++;
      document.getElementById('mensaje').innerHTML =
        `<p style="color:blue">üí∞ Venta #${numeroVenta - 1} finalizada. Iniciando nueva venta (#${numeroVenta})...</p>`;
    }

    // ======= Mostrar tabla =======
    function mostrarTabla() {
      const tabla = document.getElementById('tablaCompras');
      if (historial.length === 0) {
        tabla.innerHTML = '<p>No hay compras registradas a√∫n.</p>';
        return;
      }

      let html = `<h3>Historial de Compras</h3>
      <table><tr><th>N¬∞ Venta</th><th>Producto</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th></tr>`;

      historial.forEach(p => {
        html += `<tr>
          <td>#${p.numeroVenta}</td>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio.toLocaleString('es-CO')}</td>
          <td>$${p.total.toLocaleString('es-CO')}</td>
        </tr>`;
      });

      html += `</table>`;
      tabla.innerHTML = html;
    }

    // ======= Mostrar gr√°fico =======
    function mostrarGrafico() {
      const ctx = document.getElementById('graficoVentas');
      Chart.getChart(ctx)?.destroy();

      const nombres = [];
      const totales = [];

      historial.forEach(p => {
        const index = nombres.indexOf(p.nombre);
        if (index === -1) {
          nombres.push(p.nombre);
          totales.push(p.total);
        } else {
          totales[index] += p.total;
        }
      });

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: nombres,
          datasets: [{
            label: 'Ventas Totales por Producto',
            data: totales,
            backgroundColor: 'pink'
          }]
        },
        options: {
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    mostrarTabla();
    mostrarGrafico();
  </script>
</body>
</html>
