<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SugarSync</title>
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        background-color: #fef6f9;
        color: #444;
    }
    header {
        background-color: #ffb6c1;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-size: 1.8em;
        font-weight: bold;
        letter-spacing: 1px;
    }
    nav {
        background-color: #ffd9e1;
        display: flex;
        justify-content: center;
        gap: 15px;
        padding: 10px;
    }
    nav button {
        background-color: #fff;
        border: 1px solid #ffb6c1;
        padding: 10px 15px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        color: #ff5c8d;
        transition: 0.3s;
    }
    nav button:hover {
        background-color: #ffb6c1;
        color: white;
    }
    section {
        display: none;
        padding: 20px;
    }
    section.active {
        display: block;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        border: 1px solid #ffd9e1;
        padding: 8px;
        text-align: center;
    }
    th {
        background-color: #ffb6c1;
        color: white;
    }
    .total {
        font-weight: bold;
        color: #ff5c8d;
        margin-top: 10px;
    }
    .btn {
        background-color: #ff5c8d;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
    }
    .btn:hover {
        background-color: #ff80a1;
    }
    select, input {
        padding: 6px;
        border-radius: 8px;
        border: 1px solid #ffb6c1;
    }
</style>
</head>
<body>

<header>SugarSync</header>
<nav>
    <button onclick="mostrar('inicio')">Inicio</button>
    <button onclick="mostrar('ventas')">Ventas</button>
    <button onclick="mostrar('graficas')">Gráficas</button>
    <button onclick="mostrar('resumen')">Resumen</button>
</nav>

<section id="inicio" class="active">
    <h2>Registrar Ventas</h2>
    <p>Selecciona productos y registra las ventas del día.</p>
    <label>Fecha:</label>
    <input type="date" id="fecha" onchange="cambiarFecha()">
    <div>
        <input type="text" id="producto" placeholder="Nombre del producto">
        <input type="number" id="cantidad" placeholder="Cantidad">
        <button class="btn" onclick="agregarProducto()">Agregar</button>
    </div>
    <h3>Productos seleccionados</h3>
    <table id="tablaActual">
        <thead>
            <tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th><th>Acción</th></tr>
        </thead>
        <tbody></tbody>
    </table>
    <p class="total" id="totalPagar">Total a pagar: $0</p>
    <button class="btn" onclick="registrarVenta()">Registrar venta</button>
</section>

<section id="ventas">
    <h2>Historial de Ventas</h2>
    <table id="tablaVentas">
        <thead>
            <tr><th>Fecha</th><th>Número Venta</th><th>Producto</th><th>Cantidad</th><th>Total</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section id="graficas">
    <h2>Gráficas de Ventas</h2>
    <canvas id="grafica"></canvas>
</section>

<section id="resumen">
    <h2>Resumen de Ventas</h2>
    <div>
        <label>Tipo de Resumen:</label>
        <select id="tipoResumen">
            <option value="dia">Del día actual</option>
            <option value="general">General</option>
        </select>
        <button class="btn" onclick="actualizarResumen()">Actualizar resumen</button>
    </div>
    <div id="contenedorResumen">
        <p class="total">Ventas totales: $<span id="totalResumen">0</span></p>
        <p class="total">Productos vendidos: <span id="productosResumen">0</span></p>
        <p class="total">Número de ventas: <span id="numVentasResumen">0</span></p>
        <h3>Productos más vendidos</h3>
        <table id="tablaResumen">
            <thead>
                <tr><th>Producto</th><th>Cantidad Vendida</th><th>Total Generado</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let fechaActual = new Date().toISOString().split("T")[0];
document.getElementById("fecha").value = fechaActual;

let productos = {
    "Gansito": 2500, "Chocorramo": 3000, "Gala": 3500, "Jet": 500, "Pony Malta": 2000,
    "Coca-Cola": 2500, "Doritos": 1800, "Papas Margarita": 1500, "Bon Bon Bum": 300,
    "Trululu": 600, "Club Colombia": 4500, "Agua Brisa": 1500, "DeTodito": 2000,
    "Chocolatina Jet": 800, "Chicles Adams": 400
};
let carrito = [];
let ventas = JSON.parse(localStorage.getItem("ventas")) || {};
if (!ventas[fechaActual]) ventas[fechaActual] = [];

function mostrar(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if (id === "graficas") generarGrafica();
}

function cambiarFecha() {
    fechaActual = document.getElementById("fecha").value;
    if (!ventas[fechaActual]) ventas[fechaActual] = [];
    actualizarTablaVentas();
}

function agregarProducto() {
    let nombre = document.getElementById("producto").value.trim();
    let cantidad = parseInt(document.getElementById("cantidad").value);
    if (!nombre || !cantidad || cantidad <= 0) return alert("Complete los datos.");
    nombre = nombre.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
    if (!productos[nombre]) return alert("Producto no encontrado.");

    carrito.push({ nombre, cantidad, precio: productos[nombre], total: cantidad * productos[nombre] });
    actualizarTablaActual();
}

function actualizarTablaActual() {
    let tbody = document.querySelector("#tablaActual tbody");
    tbody.innerHTML = "";
    let total = 0;
    carrito.forEach((p, i) => {
        tbody.innerHTML += `<tr>
            <td>${p.nombre}</td><td>${p.cantidad}</td><td>$${p.precio}</td><td>$${p.total}</td>
            <td><button class='btn' onclick='eliminarProducto(${i})'>X</button></td>
        </tr>`;
        total += p.total;
    });
    document.getElementById("totalPagar").textContent = "Total a pagar: $" + total;
}

function eliminarProducto(i) {
    carrito.splice(i, 1);
    actualizarTablaActual();
}

function registrarVenta() {
    if (carrito.length === 0) return alert("No hay productos.");
    let numVenta = ventas[fechaActual].length + 1;
    carrito.forEach(p => p.venta = numVenta);
    ventas[fechaActual].push(...carrito);
    localStorage.setItem("ventas", JSON.stringify(ventas));
    carrito = [];
    actualizarTablaActual();
    actualizarTablaVentas();
    alert("Venta #" + numVenta + " registrada con éxito.");
}

function actualizarTablaVentas() {
    let tbody = document.querySelector("#tablaVentas tbody");
    tbody.innerHTML = "";
    for (let f in ventas) {
        ventas[f].forEach(v => {
            tbody.innerHTML += `<tr><td>${f}</td><td>${v.venta}</td><td>${v.nombre}</td><td>${v.cantidad}</td><td>$${v.total}</td></tr>`;
        });
    }
}

function generarGrafica() {
    const ctx = document.getElementById("grafica").getContext("2d");
    const productosVendidos = {};
    for (let f in ventas) {
        ventas[f].forEach(v => {
            productosVendidos[v.nombre] = (productosVendidos[v.nombre] || 0) + v.cantidad;
        });
    }
    const nombres = Object.keys(productosVendidos);
    const cantidades = Object.values(productosVendidos);
    new Chart(ctx, {
        type: "bar",
        data: {
            labels: nombres,
            datasets: [{
                label: "Cantidad vendida",
                data: cantidades,
                backgroundColor: "#ffb6c1"
            }]
        }
    });
}

function actualizarResumen() {
    const tipo = document.getElementById("tipoResumen").value;
    let data = tipo === "dia" ? ventas[fechaActual] || [] : Object.values(ventas).flat();

    let total = 0, totalProductos = 0, resumen = {}, numVentas = 0;
    const ventasUnicas = new Set();

    data.forEach(v => {
        total += v.total;
        totalProductos += v.cantidad;
        resumen[v.nombre] = (resumen[v.nombre] || { cantidad: 0, total: 0 });
        resumen[v.nombre].cantidad += v.cantidad;
        resumen[v.nombre].total += v.total;
        ventasUnicas.add(`${v.fecha}-${v.venta}`);
    });
    numVentas = ventasUnicas.size;

    document.getElementById("totalResumen").textContent = total;
    document.getElementById("productosResumen").textContent = totalProductos;
    document.getElementById("numVentasResumen").textContent = numVentas;

    const tbody = document.querySelector("#tablaResumen tbody");
    tbody.innerHTML = "";
    for (let p in resumen) {
        tbody.innerHTML += `<tr><td>${p}</td><td>${resumen[p].cantidad}</td><td>$${resumen[p].total}</td></tr>`;
    }
}
</script>

</body>
</html>
